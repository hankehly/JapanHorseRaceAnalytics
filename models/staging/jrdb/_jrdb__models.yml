models:
  - name: stg_jrdb__bac
    columns:
      - name: bac_sk
        tests:
          # takes way too long
          # - unique
          - not_null
      - name: bac_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 年月日
        tests:
          - not_null
      - name: 発走時間
        tests:
          - not_null
      - name: レース条件_距離
        tests:
          - not_null
      - name: レース条件_トラック情報_芝ダ障害コード
        description: 1:芝, 2:ダート, 3:障害
        tests:
          - not_null
          - accepted_values:
              values: ["芝", "ダート", "障害"]
      - name: レース条件_トラック情報_右左
        description: 1:右, 2:左, 3:直, 9:他
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 9]
      - name: レース条件_トラック情報_内外
        description: |
          1:通常(内), 2:外, 3,直ダ, 9:他
          ※障害のトラックは、以下の２通りとなります。
            "393":障害直線ダート
            "391":障害直線芝
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3, 9]
      - name: レース条件_種別
        description: ４歳以上等、→JRDBデータコード表
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__race_category_codes')
              field: code
      - name: レース条件_条件
        description: 900万下等、 →JRDBデータコード表
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__race_condition_codes')
              field: code
      - name: レース条件_記号
        description: ○混等、    →JRDBデータコード表
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__special_mention_codes')
              field: code
      - name: レース条件_重量
        description: ハンデ等、  →JRDBデータコード表
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__weight_condition_codes')
              field: code
      - name: レース条件_グレード
        description: Ｇ１等      →JRDBデータコード表
        tests:
          - relationships:
              to: ref('jrdb__grade_codes')
              field: code
      - name: レース名
        description: レース名の通称（全角２５文字）
      - name: 回数
        description: 第ZZ9回（全角半角混在）
      - name: 頭数
        tests:
          - not_null
      - name: コース
        description: 1:A, 2:A1, 3:A2, 4:B, 5:C, 6:D
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6]
      - name: 開催区分
        description: 1:関東, 2:関西, 3:ローカル
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: レース名短縮
      - name: レース名９文字
        tests:
          - not_null
      - name: データ区分
        description: 1:特別登録, 2:想定確定, 3:前日
        tests:
          - not_null
      - name: １着賞金
        description: 単位（万円）
        tests:
          - not_null
      - name: ２着賞金
        description: 単位（万円）
        tests:
          - not_null
      - name: ３着賞金
        description: 単位（万円）
        tests:
          - not_null
      - name: ４着賞金
        description: 単位（万円）
        tests:
          - not_null
      - name: ５着賞金
        description: 単位（万円）
        tests:
          - not_null
      - name: １着算入賞金
        description: 単位（万円）
        tests:
          - not_null
      - name: ２着算入賞金
        description: 単位（万円）
        tests:
          - not_null
      - name: 馬券発売フラグ_単勝
        description: 1:発売, 0:発売無し
        tests:
          - not_null
      - name: 馬券発売フラグ_複勝
        description: 1:発売, 0:発売無し
        tests:
          - not_null
      - name: 馬券発売フラグ_枠連
        description: 1:発売, 0:発売無し
        tests:
          - not_null
      - name: 馬券発売フラグ_馬連
        description: 1:発売, 0:発売無し
        tests:
          - not_null
      - name: 馬券発売フラグ_馬単
        description: 1:発売, 0:発売無し
        tests:
          - not_null
      - name: 馬券発売フラグ_ワイド
        description: 1:発売, 0:発売無し
        tests:
          - not_null
      - name: 馬券発売フラグ_３連複
        description: 1:発売, 0:発売無し
        tests:
          - not_null
      - name: 馬券発売フラグ_３連単
        description: 1:発売, 0:発売無し
        tests:
          - not_null
      - name: WIN5フラグ
        description: 1～5

  - name: stg_jrdb__cha
    columns:
      - name: cha_sk
        tests:
          - unique
          - not_null
      - name: cha_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 曜日
        tests:
          - not_null
      - name: 調教年月日
        tests:
          - not_null
      - name: 回数
        tests:
          - not_null
      - name: 調教コースコード # there's only 1 null value in the whole dataset..
        tests:
          - relationships:
              to: ref('jrdb__training_course_codes')
              field: code
      - name: 追切種類
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 追い状態
        tests:
          - relationships:
              to: ref('jrdb__workout_status_codes')
              field: code
      - name: 乗り役
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: 調教Ｆ
        tests:
          - not_null
      - name: 時計分析データ_テンＦ
      - name: 時計分析データ_中間Ｆ
      - name: 時計分析データ_終いＦ
      - name: 時計分析データ_テンＦ指数
      - name: 時計分析データ_中間Ｆ指数
      - name: 時計分析データ_終いＦ指数
      - name: 時計分析データ_追切指数
      - name: 併せ馬相手データ_併せ結果
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 併せ馬相手データ_追切種類
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 併せ馬相手データ_年齢
      - name: 併せ馬相手データ_クラス
        tests:
          - relationships:
              to: ref('jrdb__race_condition_codes')
              field: code

  - name: stg_jrdb__cyb
    columns:
      - name: cyb_sk
        tests:
          # takes way too long
          # - unique
          - not_null
      - name: cyb_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 調教タイプ # ??
      - name: 調教コース種別 # ??
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4, 5]
      - name: 調教コース種類_坂
        tests:
          - not_null
      - name: 調教コース種類_Ｗ
        tests:
          - not_null
      - name: 調教コース種類_ダ
        tests:
          - not_null
      - name: 調教コース種類_芝
        tests:
          - not_null
      - name: 調教コース種類_プ
        tests:
          - not_null
      - name: 調教コース種類_障
        tests:
          - not_null
      - name: 調教コース種類_ポ
        tests:
          - not_null
      - name: 調教距離
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 調教重点
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 追切指数
      - name: 仕上指数
      - name: 調教量評価
        description: A,B,C,Dに分類 (コード等の詳細説明は、【調教分析データ内容の説明】を参照してください。)
        tests:
          - accepted_values:
              values: ["A", "B", "C", "D"]
      - name: 仕上指数変化
        tests:
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 調教コメント
      - name: コメント年月日
      - name: 調教評価
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 一週前追切指数
      - name: 一週前追切コース
        description: 一週前追切の調教の追切コース (コード等の詳細説明は、【調教分析データ内容の説明】を参照してください。)
        tests:
          - relationships:
              to: ref('jrdb__training_course_codes')
              field: code
  - name: stg_jrdb__hjc
    columns:
      - name: hjc_sk
        tests:
          - unique
          - not_null
      - name: hjc_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 単勝払戻
        tests:
          - not_null
      - name: 複勝払戻
        tests:
          - not_null
      - name: 枠連払戻
        tests:
          - not_null
      - name: 馬連払戻
        tests:
          - not_null
      - name: ワイド払戻
        tests:
          - not_null
      - name: 馬単払戻
        tests:
          - not_null
      - name: ３連複払戻
        tests:
          - not_null
      - name: ３連単払戻
        tests:
          - not_null
  - name: stg_jrdb__kab
    columns:
      - name: kab_sk
        tests:
          - unique
          - not_null
      - name: kab_bk
        tests:
          - unique
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: 開催キー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: 開催キー_年
        tests:
          - not_null
      - name: 開催キー_回
        tests:
          - not_null
      - name: 開催キー_日
        tests:
          - not_null
      - name: 年月日
        description: YYYYMMDD
        tests:
          - not_null
      - name: 開催区分
        description: 1:関東, 2:関西, 3:ローカル
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: 曜日
        description: 日－土
        tests:
          - not_null
          - accepted_values:
              values: ["月", "火", "水", "木", "金", "土", "日"]
      - name: 場名
        description: 競馬場名
      - name: 天候コード
        tests:
          - relationships:
              to: ref('jrdb__weather_codes')
              field: code
      - name: 芝馬場状態コード
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態内
        description: 1:絶好, 2:良, 3,稍荒, 4:荒
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態中
        description: 1:絶好, 2:良, 3,稍荒, 4:荒
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場状態外
        description: 1:絶好, 2:良, 3,稍荒, 4:荒
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 芝馬場差
      - name: 直線馬場差最内
      - name: 直線馬場差内
      - name: 直線馬場差中
      - name: 直線馬場差外
      - name: 直線馬場差大外
      - name: ダ馬場状態コード
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態内
        description: 1:絶好, 2:良, 3,稍荒, 4:荒
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態中
        description: 1:絶好, 2:良, 3,稍荒, 4:荒
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場状態外
        description: 1:絶好, 2:良, 3,稍荒, 4:荒
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: ダ馬場差
      - name: データ区分
        description: 1:特別登録,2:想定確定,3:枠確定,4:前日
        tests:
          - accepted_values:
              values: [1, 2, 3, 4]
      - name: 連続何日目
        description: 日数
        tests:
          - not_null
      - name: 芝種類
        description: 1:野芝, 2:洋芝, 3:混生
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 草丈
        description: 単位cm
      - name: 転圧
        description: 1:転圧, 0:無し
      - name: 凍結防止剤
        description: 1:凍結防止剤散布, 0:無し
      - name: 中間降水量
        description: 単位mm

  - name: stg_jrdb__kyi
    description: 競走馬ごとのデータ。IDM、各指数を格納、放牧先を追加。
    columns:
      - name: kyi_sk
        tests:
          # Takes too long
          # - unique
          - not_null
      - name: kyi_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 血統登録番号
        tests:
          - not_null
      - name: 馬名
        tests:
          - not_null
      - name: ＩＤＭ
        description: |
          □ＩＤＭ（インデックスメモリー）
          IDMとは、スピード指値に記憶（レース内容、馬場状態、当日の馬のコンディショ
          ン等）を数値化したものです。勿論、馬の状態、馬装具点検を肉眼で同じ場所で
          客観的に観るようにしています。ようするに競馬は時計だけではなく”記憶”も
          重要ではないかとの理論です。詳細なファクターは下記の通りです。

          　IDM「インデックス（スピード能力）・メモリー（記憶）」の算出方法。
          　　Ａ   基準タイム…  各競馬場 （距離・芝・ダート）別走破タイム。
          　　Ｂ   馬場差…      芝、ダート馬場状態（速良・良・遅良・速稍重・
          　　                   稍重・遅稍重・速重・重・遅い重・速不・不・遅不）
          　　                   天候（雨・雪・風・雷・霧）
          　　Ｃ   斤量…        別定・ハンディ・馬齢・基準0.5kg。
          　　Ｄ   レース内容…  出遅れ・不利・落鉄・放馬・勝ち振り等。
          　　Ｅ   位地取り…    最内・内・中・外・大外の馬場差。
          　　                   各コーナー差。
          　　Ｆ   ペース…      レースペース．前３F/５F．後３F/２F。

          等をレース毎に数値化した数値に他のファクター（秘）を取り入れ該当レース条
          件に調整した数値です。 現在、馬柱にIDMと表記されていますが、実際はIDM調
          整値です。
        tests:
          - not_null
      - name: 騎手指数
        description: 基準オッズと騎手の連対率の関係を基に算出された指数値。
        tests:
          - not_null
      - name: 情報指数
        description: 基準オッズ、厩舎指数、調教指数等様々な情報を基に算出された指数値。
        tests:
          - not_null
      - name: 総合指数
        description: ＩＤＭ、騎手指数、情報指数を合計した値。
        tests:
          - not_null
      - name: 脚質
        description: 過去の競走実績よりその馬の脚質を判断したコード。
        tests:
          - relationships:
              to: ref('jrdb__run_style_codes')
              field: code
      - name: 距離適性
        description: 該当馬の実績、血統、馬体から判断される距離適性をコード化。
        tests:
          - relationships:
              to: ref('jrdb__distance_aptitude_codes')
              field: code
      - name: 上昇度
        description: 前走から（次走へ向けて）の上積みの度合い
        tests:
          - relationships:
              to: ref('jrdb__improvement_codes')
              field: code
      - name: ローテーション
        description: 間に金曜日が入っている数で決定、連闘は０、初出走はスペースとなる。
      - name: 基準オッズ
        description: |
          関西・関東の各専門情報紙(予想・評論家等)(関東約9紙150人前後・関西約8紙100人前後)
          の印を独自に分析し算出した単勝基準オッズ(時系列分析対応)になっています。
        tests:
          - not_null
      - name: 基準人気順位
        tests:
          - not_null
      - name: 基準複勝オッズ
        description: |
          関西・関東の各専門情報紙(予想・評論家等)(関東約9紙150人前後・関西約8紙100人前後)
          の印を独自に分析し算出した複勝基準オッズ(時系列分析対応)になっています。
        tests:
          - not_null
      - name: 基準複勝人気順位
        tests:
          - not_null
      - name: 特定情報◎
        description: 専門情報紙の特定の情報値。
        tests:
          - not_null
      - name: 特定情報○
        description: 専門情報紙の特定の情報値。
        tests:
          - not_null
      - name: 特定情報▲
        description: 専門情報紙の特定の情報値。
        tests:
          - not_null
      - name: 特定情報△
        description: 専門情報紙の特定の情報値。
        tests:
          - not_null
      # https://github.com/hankehly/JapanHorseRaceAnalytics/issues/22
      - name: 特定情報×
        description: 専門情報紙の特定の情報値。
        tests:
          - not_null
      - name: 総合情報◎
        description: 情報・専門紙の印数（総合）
        tests:
          - not_null
      - name: 総合情報○
        description: 情報・専門紙の印数（総合）
        tests:
          - not_null
      - name: 総合情報▲
        description: 情報・専門紙の印数（総合）
        tests:
          - not_null
      - name: 総合情報△
        description: 情報・専門紙の印数（総合）
        tests:
          - not_null
      # https://github.com/hankehly/JapanHorseRaceAnalytics/issues/22
      - name: 総合情報×
        description: 情報・専門紙の印数（総合）
        tests:
          - not_null
      - name: 人気指数
        description: その馬の人気を指数化した値。
        tests:
          - not_null
      # https://github.com/hankehly/JapanHorseRaceAnalytics/issues/22
      - name: 調教指数
        description: |
          関西・関東の各専門情報紙を分析し、独自のデータベースを作成、そのデータベースをもとに下記の指数を算出しています。
          各専門紙・情報紙の予想・評論家等が担当の調教コースにおいてどれだけ正確に馬の状態を判断しているかを数値化したデータベースをもとに、専門情報紙の印を分析して算出した数値。
        tests:
          - not_null
      - name: 厩舎指数
        description: |
          調教指数同様、独自のデータベースを作成、そのデータベースをもとに下記の指数を算出しています。
          各専門紙・情報紙の予想・評論家等と厩舎との密接度を数値化したデータベースをもとに、専門情報紙の印を分析して算出した数値。
        tests:
          - not_null
      - name: 調教矢印コード
        description: |
          調教から見た馬の調子をわかりやすく５段階評価したもの。
          (JRDBデータコード表参照)
          Raw data contains 2 nulls from 1999, replaced with most common value.
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__trainer_evaluation_codes')
              field: code
      - name: 厩舎評価コード
        description: |
          厩舎サイドの期待度をわかりやすく４段階評価したもの。
          (JRDBデータコード表参照)
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__stable_evaluation_codes')
              field: code
      - name: 騎手期待連対率
        description: |
          騎手別に、基準オッズ範囲毎の連対成績を集計したもの。
          騎手Ａが単勝基準オッズＢの馬に乗った場合の過去の成績を集計し、算出された連対率を騎手期待連対率としています。
          データには、今回の基準オッズにおける騎手期待連対率が入ります。
        tests:
          - not_null
      - name: 激走指数
        description: |
          過去の高配当レースを分析し得られた激走するさまざまな要素を数値化し合計したもの。主な要素を以下に示します。
          コース枠脚質、騎手、騎手乗り替り、馬具変更、距離適正、クラス、馬体、気配、上昇度、激走情報指数（専門情報紙の印を激走用に分析したもの）
          ※競馬新聞の大穴激走注目馬は、人気が低く、激走指数の高い馬です。
        tests:
          - not_null
      - name: 蹄コード
        description: |
          パドックでの観察により馬の蹄を分類したもの。
          各馬の蹄の大きさを大・中・小・細の４種類に、形状を立・標準・標準立・標準ベ・ベタの５種類に分類しています。
          「中ベタ」なら蹄の大きさは中ぐらいでベタ蹄という意味です。
          芝の重馬場、荒馬場では蹄の立っている馬が有利になります。但しダート戦に関してはこの限りではありません。
          (JRDBデータコード表参照)
        tests:
          - relationships:
              to: ref('jrdb__paddock_observed_hoof_codes')
              field: code
      - name: 重適性コード # fixed 正→性 naming mistake
        description: |
          過去の成績、蹄の形状等よりその馬の重馬場への適性を３段階評価したもの。
          (JRDBデータコード表参照)
        tests:
          - relationships:
              to: ref('jrdb__heavy_ground_aptitude_codes')
              field: code
      - name: クラスコード
        description: |
          馬の能力をクラスで分けたもの。
          芝ＯＰＡ　・・・　芝のオープン戦で勝つ能力のある馬。
          芝ＯＰＢ　・・・　芝のオープン戦で好戦できる能力のある馬。
          芝ＯＰＣ　・・・　芝のオープン戦で頭打ちの馬。
          (JRDBデータコード表参照)
        tests:
          - relationships:
              to: ref('jrdb__class_codes')
              field: code
      - name: ブリンカー
        description: 1:初装着,2:再装着,3:ブリンカ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 騎手名
        tests:
          - not_null
      - name: 負担重量
        description: 0.1Kg単位
        tests:
          - not_null
      - name: 見習い区分
        description: 1:☆(1K減),2:△(2K減),3:▲(3K減),4:★(4K減),9:◇(2K減)
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 9]
      - name: 調教師名
        tests:
          - not_null
      - name: 調教師所属 # only like 6 null rows

      # Todo: these should relate to SED/SKB 競走成績キー
      - name: 他データリンク用キー_前走１競走成績キー
      - name: 他データリンク用キー_前走２競走成績キー
      - name: 他データリンク用キー_前走３競走成績キー
      - name: 他データリンク用キー_前走４競走成績キー
      - name: 他データリンク用キー_前走５競走成績キー

      # Todo: these should relate SED also?
      - name: 他データリンク用キー_前走１レースキー
      - name: 他データリンク用キー_前走２レースキー
      - name: 他データリンク用キー_前走３レースキー
      - name: 他データリンク用キー_前走４レースキー
      - name: 他データリンク用キー_前走５レースキー

      - name: 枠番
        tests:
          - not_null
      - name: 印コード_総合印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: 印コード_ＩＤＭ印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: 印コード_情報印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: 印コード_騎手印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: 印コード_厩舎印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: 印コード_調教印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: 印コード_激走印
        description: 1:激走馬
        tests:
          - not_null
      - name: 芝適性コード
        description: 1:◎, 2:○, 3:△
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: ダ適性コード
        description: 1:◎, 2:○, 3:△
        tests:
          - accepted_values:
              values: [1, 2, 3]

      # todo
      - name: 騎手コード
        description: 騎手マスタとリンク

      # todo
      - name: 調教師コード
        description: 調教師マスタとリンク

      - name: 賞金情報_獲得賞金
        description: 単位万円(含む付加賞)
        tests:
          - not_null
      - name: 賞金情報_収得賞金
        description: 単位万円
        tests:
          - not_null
      - name: 賞金情報_条件クラス
        description: 収得賞金から出走できるクラス
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__race_condition_codes')
              field: group_code
      - name: 展開予想データ_テン指数
        description: 予想テン指数
      - name: 展開予想データ_ペース指数
        description: 予想ペース指数
      - name: 展開予想データ_上がり指数
        description: 予想上がり指数
      - name: 展開予想データ_位置指数
        description: 予想位置指数
      - name: 展開予想データ_ペース予想
        description: H,M,S
        tests:
          - accepted_values:
              values: [H, M, S]
      - name: 展開予想データ_道中順位
      - name: 展開予想データ_道中差
        description: 半馬身(約0.1秒)単位
      - name: 展開予想データ_道中内外
        tests:
          - accepted_values:
              values: [2, 3, 4, 5]
      - name: 展開予想データ_後３Ｆ順位
      - name: 展開予想データ_後３Ｆ差
      - name: 展開予想データ_後３Ｆ内外
        tests:
          - accepted_values:
              values: [2, 3, 4, 5]
      - name: 展開予想データ_ゴール順位
      - name: 展開予想データ_ゴール差
      - name: 展開予想データ_ゴール内外
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5]
      - name: 展開予想データ_展開記号
        tests:
          - relationships:
              to: ref('jrdb__race_development_codes')
              field: code
      - name: 距離適性２ # what does this field mean given we already have 距離適性?
        tests:
          - relationships:
              to: ref('jrdb__distance_aptitude_codes')
              field: code
      - name: 枠確定馬体重
        description: |
          Note: Useless. Only contains null values.

      # do null and 0 mean the same thing?
      - name: 枠確定馬体重増減
        description: |
          符号+数字２桁,データ無:スペース
          Note: Useless. Only contains null values.

      - name: 取消フラグ
        description: 1:取消
        tests:
          - not_null
      - name: 性別コード
        description: 1:牡,2:牝,3,セン
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: 馬主名
        tests:
          - not_null
      - name: 馬主会コード
        description: |
          競馬場毎にあり、コードは、場コードと同じです。馬主会に所属されていない馬主の方もおられます。
          馬主会が「不明」の方は、スペースになっています。
          例）京都馬主会 ⇒ "08"
          ※"10" は、九州馬主会です。
          "00":無所属,スペース:不明
      - name: 馬記号コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__horse_symbol_codes')
              field: code
      - name: 激走順位
        description: レース出走馬中での順位
      - name: LS指数順位
      - name: テン指数順位
      - name: ペース指数順位
      - name: 上がり指数順位
      - name: 位置指数順位
      - name: 騎手期待単勝率
      - name: 騎手期待３着内率
      - name: 輸送区分
        description: |
          滞在、遠征などの輸送過程を表します。直前輸送（直輸）を通常／遠征に分けました。
          1 滞在 ローカル競馬場で、競馬場に入厩している馬を表します。
          2 通常 栗東→京都、美浦→中山等や、札幌→函館を通常としています。
          3 遠征 栗東→中山、栗東→小倉等の長距離輸送を遠征としています。
          4 連闘 下記【滞在】の説明参照
          0 不明 

          輸送区分は、レース週の最終追い切り（通常は、水or木）の場所で判断しています。

          【滞在】の定義
          　ローカル競馬場（札幌、函館、福島、新潟、小倉）開催において
          　レース週の最終追い切りを、当該競馬場で行っている場合、【滞在】としています。
          　連闘馬の場合、おそらく滞在と思われますが、"連闘"と分類しています。
          　滞在馬で分析する場合、"滞在" あるいは"連闘"と指定すると実際的です。
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3, 4]
      - name: 走法
        description: don't use, this field is no longer updated
      - name: 体型_全体
        description: 馬体の全体的な形状
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_背中
        description: 長さ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_胴
        description: 長さ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_尻
        description: 大きさ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_トモ
        description: 角度
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_腹袋
        description: 大きさ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_頭
        description: 大きさ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_首
        description: 長さ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_胸
        description: 大きさ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_肩
        description: 角度
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_前長
        description: 長さ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_後長
        description: 長さ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_前幅
        description: 前脚の歩幅
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_後幅
        description: 後脚の歩幅
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_前繋
        description: 長さ
        tests:
          - accepted_values:
              values: [1, 2, 3]
      - name: 体型_後繋
        description: 長さ
        tests:
          - accepted_values:
              values: [1, 2, 3]
        # 体型_尾 and 体型_振 contain mostly nulls and shouldn't be used
      - name: 体型_尾
        description: つけ根の上げ方	1:上げる,2:下げる
      - name: 体型_振
        description: 尾の振り方	1:激しい,2:少し,3:あまり振らない
      - name: 体型_予備1
      - name: 体型_予備2
      - name: 体型_予備3
      - name: 体型_予備4
      - name: 体型_予備5
      - name: 体型_予備6
      - name: 体型_予備7
      - name: 体型_予備8
      - name: 体型総合１
        tests:
          - relationships:
              to: ref('jrdb__special_mention_codes')
              field: code
      - name: 体型総合２
        tests:
          - relationships:
              to: ref('jrdb__special_mention_codes')
              field: code
      - name: 体型総合３
        tests:
          - relationships:
              to: ref('jrdb__special_mention_codes')
              field: code
      - name: 馬特記１
        tests:
          - relationships:
              to: ref('jrdb__special_mention_codes')
              field: code
      - name: 馬特記２
        tests:
          - relationships:
              to: ref('jrdb__special_mention_codes')
              field: code
      - name: 馬特記３
        tests:
          - relationships:
              to: ref('jrdb__special_mention_codes')
              field: code
      - name: 展開参考データ_馬スタート指数
      - name: 展開参考データ_馬出遅率

      # このフィールドの意味/形式が分からない
      - name: 展開参考データ_参考前走
        description: 参考となる前走（２走分格納）

      # todo: relationship with 騎手 master
      - name: 展開参考データ_参考前走騎手コード
        description: 参考となる前走の騎手

      - name: 万券指数
        description: |
          ＪＲＤＢでの穴馬分析は激走指数ですが、これをベースに穴得意の展開予想を加え、
          さらには人気となりがちな情報を減点し、万券に狙いを定めた分析です。

      # 1-8が格納されている
      - name: 万券印
        description: |
          ＪＲＤＢでの穴馬分析は激走指数ですが、これをベースに穴得意の展開予想を加え、
          さらには人気となりがちな情報を減点し、万券に狙いを定めた分析です。
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code

      # このフィールドは19'以降全部「0:通常」になっているので使わない方が良さそう
      - name: 降級フラグ
        description: |
          ４歳馬の場合６月中旬ごろクラス編成が行なわれます。この後、出走可能なレース
          条件が下がり前半より下のレース条件で出走する場合、このフラグがONとなります。
          クラスが２つ下のレースに出走できる２段階降級もあります。
          1:降級, 2:２段階降級, 0:通常
        tests:
          - accepted_values:
              values: [0, 1, 2]

      - name: 激走タイプ
        description: |
          激走馬選定の候補に上がった馬を含めた、激走馬のタイプです。
          穴馬分析用データとして出力しました。

          タイプ
          A1 激走馬、中位人気グループで激走指数１番手
          A2 激走馬、中位人気グループで激走指数２番手
          A3 激走馬、中位人気グループで激走指数３番手
          A4 中位人気グループで激走指数４番手
          B1 下位人気グループで激走指数１番手
          B2 下位人気グループで激走指数１番手

          基本的によく来ている激走馬は、"A1"と"A2"です。
          現在"A4","B1","B2"は、激走馬としていません。

          ※以前は、３頭目の激走馬は"B1"にしていましたが、成績が良くないため、"A3"に変更しました。
          激走馬は分析により、最適な激走馬タイプに変更される可能性があります。
          過去分析される場合は、激走タイプを使用することをお勧めします。
        tests:
          - accepted_values:
              values: [A1, A2, A3, A4, B1, B2]
      - name: 休養理由分類コード
        tests:
          - relationships:
              to: ref('jrdb__rest_reason_codes')
              field: code
      - name: 芝ダ障害フラグ
        description: |
          0:変化なし
          1:トラック替り(芝ダ替り)
          2:初トラック(初芝,初ダ,初障)
        tests:
          - accepted_values:
              values: [0, 1, 2]
      - name: 距離フラグ
        description: |
          0: 経験有り
          1: 最長距離
        tests:
          - accepted_values:
              values: [0, 1]
      - name: クラスフラグ
        description: |
          0: 変化なし
          1: 昇級初戦
          2: 降級
          3: 格上挑戦
        tests:
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 転厩フラグ
        description: |
          0:変化なし
          1～3:転厩何戦目（３戦目まで）
        tests:
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 去勢フラグ
        description: |
          0:変化なし
          1～3:去勢何戦目（３戦目まで）
        tests:
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 乗替フラグ
        description: |
          0: 変化なし
          1: 乗替 (初)
          9: 乗替 (再)
        tests:
          - accepted_values:
              values: [0, 1, 9]

      # just contains blank space
      - name: 予備フラグ

      - name: 入厩何走目
        description: 例）2:入厩後２走目
      - name: 入厩年月日
      - name: 入厩何日前
        description: |
          レース日から遡っての入厩の日数
          （今走前に入厩の場合）
      - name: 放牧先
        description: |
          判明した分だけ出力されます。
          地域名だけの場合もあります。
          「放牧先」には最近入厩してきた元の出発地（主に牧場名）が入ります。
          入厩何走目が１の場合は、この中間で放牧に出されていたことになり、２なら、放牧から帰厩して、２走目となります。
          入厩何日前は、この中間で放牧に出されていた場合にセットされます。
      - name: 放牧先ランク
        description: |
          休み明けの放牧先データを分析して放牧先ランクを作成。

          連対率を放牧先別に分析し、ランク分けを行いました。
          １３％以上　　Ａランク　「休み明けのハンデが無い」ということ
          １１－１３％　Ｂランク
          ９－１１％　　Ｃランク　普通
          ７－９％　　　Ｄランク
          ７％以下　　　Ｅランク

          ※データが２０件以下はランク未設定としています。

          ※入厩・放牧先データについての注意事項
          ・放牧先に関して「○○県」「○○町」など、地域のみ掲載する場合があります。
          ・入厩のパターン等によっては、入厩データがない場合もあります。
          ・入厩情報に関してはレース前日にＪＲＤＢが入手しているデータまでが反映されます。
          ・入厩データが出走に間に合っていない場合、また入厩データがない場合は「情報無し」となります。
          ・間に合わなかったデータは後日取り込まれることになります。それを反映したデータは定期的に再作成します。
        tests:
          - accepted_values:
              values: [A, B, C, D, E]
      - name: 厩舎ランク
        description: |
          ランクと色付けの対応について。 
          デフォルトは５。→何も色無し。
          ４は欠番
          １・S級　ピンク
          ２・A級　オレンジ
          ３・B級　黄色
          ５・ノーマル
          ６・D級　青
          ７・E級　紫
          ８・F級　灰色
          ９・その他総数１０以下の厩舎
        tests:
          - accepted_values:
              values: [1, 2, 3, 4, 5, 6, 7, 8, 9]

  - name: stg_jrdb__sed
    columns:
      - name: sed_sk
        tests:
          # takes way too long and is not strictly necessary because spark does this for us
          # - unique
          - not_null
      - name: sed_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 競走成績キー_血統登録番号
        description: 競走馬データとのリンクに使用
      - name: 競走成績キー_年月日
        description: 競走馬データとのリンクに使用 | YYYYMMDD <-暫定版より順序
      - name: 馬名
        description: 全角１８文字 <-入れ替え
      - name: レース条件_距離
      - name: レース条件_トラック情報_芝ダ障害コード
        tests:
          - not_null
          - accepted_values:
              values: [芝, ダート, 障害]
      - name: レース条件_トラック情報_右左
        description: 1:右, 2:左, 3:直, 9:他
      - name: レース条件_トラック情報_内外
        description: |
          1:通常(内), 2:外, 3,直ダ, 9:他,
          ※障害のトラックは、以下の２通りとなります。
          "393":障害直線ダート
          "391":障害直線芝
      - name: レース条件_馬場状態
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__going_codes')
              field: code
      - name: レース条件_種別
        description: ４歳以上等、→成績データの説明
      - name: レース条件_条件
        description: 900万下等、 →成績データの説明
      - name: レース条件_記号
        description: ○混等、 →成績データの説明
      - name: レース条件_重量
        description: ハンデ等、 →成績データの説明
      - name: レース条件_グレード
      - name: レース条件_レース名
        description: レース名の通称（全角２５文字）
      - name: レース条件_頭数
      - name: レース条件_レース名略称
        description: 全角４文字
      - name: 馬成績_着順
      - name: 馬成績_異常区分
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__anomaly_codes')
              field: code
      - name: 馬成績_タイム
        description: 1byte_length:分, 2-4byte_length:秒(0.1秒単位)
      - name: 馬成績_斤量
        description: 0.1Kg単位
      - name: 馬成績_騎手名
        description: 全角６文字
      - name: 馬成績_調教師名
        description: 全角６文字
      - name: 馬成績_確定単勝オッズ
      - name: 馬成績_確定単勝人気順位
      - name: ＪＲＤＢデータ_ＩＤＭ
      - name: ＪＲＤＢデータ_素点
      - name: ＪＲＤＢデータ_馬場差
      - name: ＪＲＤＢデータ_ペース
      - name: ＪＲＤＢデータ_出遅
      - name: ＪＲＤＢデータ_位置取
      - name: ＪＲＤＢデータ_不利
      - name: ＪＲＤＢデータ_前不利
        description: 前３Ｆ内での不利
      - name: ＪＲＤＢデータ_中不利
        description: 道中での不利
      - name: ＪＲＤＢデータ_後不利
        description: 後３Ｆ内での不利
      - name: ＪＲＤＢデータ_レース
      - name: ＪＲＤＢデータ_コース取り
        description: 1:最内,2:内,3:中,4:外,5:大外
      - name: ＪＲＤＢデータ_上昇度コード
        description: 1:AA, 2:A, 3:B, 4:C, 5:?
      - name: ＪＲＤＢデータ_クラスコード
      - name: ＪＲＤＢデータ_馬体コード
      - name: ＪＲＤＢデータ_気配コード
      - name: ＪＲＤＢデータ_レースペース
        description: H:ハイ, M:平均, S:スロー
      - name: ＪＲＤＢデータ_馬ペース
        description: 馬自身のペース(H:M:S)
      - name: ＪＲＤＢデータ_テン指数
        description: 前３Ｆタイムを指数化したもの
      - name: ＪＲＤＢデータ_上がり指数
        description: 後３Ｆタイムを指数化したもの
      - name: ＪＲＤＢデータ_ペース指数
        description: 馬のペースを指数化したもの
      - name: ＪＲＤＢデータ_レースＰ指数
        description: レースのペースを指数化したもの
      - name: ＪＲＤＢデータ_1(2)着馬名
        description: 全角６文字
      - name: ＪＲＤＢデータ_1(2)着タイム差
        description: 0.1秒単位
      - name: ＪＲＤＢデータ_前３Ｆタイム
        description: 0.1秒単位
      - name: ＪＲＤＢデータ_後３Ｆタイム
        description: 0.1秒単位
      - name: ＪＲＤＢデータ_備考
        description: 全角１２文字（地方競馬場名等）
      - name: 確定複勝オッズ下
        description: 最終的な複勝オッズ（下限）
      - name: 10時単勝オッズ
        description: 10時頃の単勝オッズ
      - name: 10時複勝オッズ
        description: 10時頃の複勝オッズ
      - name: コーナー順位１
      - name: コーナー順位２
      - name: コーナー順位３
      - name: コーナー順位４
      - name: 前３Ｆ先頭差
        description: 前３Ｆ地点での先頭とのタイム差 (0.1秒単位)
      - name: 後３Ｆ先頭差
        description: 後３Ｆ地点での先頭とのタイム差 (0.1秒単位)
      - name: 騎手コード
        description: 騎手マスタとリンク
        tests:
          - not_null
      - name: 調教師コード
        description: 調教師マスタとリンク
        tests:
          - not_null
      - name: 馬体重
        description: データ無:スペース
      - name: 馬体重増減
        description: 符号+数字２桁、データ無:スペース
      - name: 天候コード
        description: コード表参照
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__weather_codes')
              field: code
      - name: コース
        description: 1:A,2:A1,3:A2,4:B,5:C,6:D
      - name: レース脚質
        description: 脚質コード参照
        tests:
          - relationships:
              to: ref('jrdb__run_style_codes')
              field: code
      - name: 払戻データ_単勝
        description: 単位（円）
      - name: 払戻データ_複勝
        description: 単位（円）
      - name: 本賞金
        description: 単位（万円）
      - name: 収得賞金
        description: |
          単位（万円）
          https://dic.nicovideo.jp/a/%E5%8F%8E%E5%BE%97%E8%B3%9E%E9%87%91
      - name: レースペース流れ
        description: →成績データの説明
      - name: 馬ペース流れ
        description: →成績データの説明
      - name: ４角コース取り
        description: 1:最内,2:内,3:中,4:外,5:大外
      - name: 発走時間
        description: HHMM

  - name: stg_jrdb__tyb
    columns:
      - name: tyb_sk
        tests:
          # Takes way too long. Just trust pyspark is doing this for us correctly
          # - unique
          - not_null
      - name: tyb_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: ＩＤＭ
        tests:
          - not_null
      - name: 騎手指数
        tests:
          - not_null
      - name: 情報指数
        tests:
          - not_null
      - name: オッズ指数
        tests:
          - not_null
      - name: パドック指数
        tests:
          - not_null
      - name: 予備１
      - name: 総合指数
        tests:
          - not_null
      - name: 馬具変更情報
        description: |
          0:馬具変更なし
          1:馬具変更（通常）
          2:馬具変更（特注）特に効果があると思われる馬具変更。
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2]
      - name: 脚元情報
        description: |
          0:平行線
          1:良化（!）
          2:疑問（?）
          3:悪化（X）
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 取消フラグ
        description: 取消フラグ
        tests:
          - not_null

      # todo: link with 騎手 master
      - name: 騎手コード
        tests:
          - not_null

      - name: 騎手名
        tests:
          - not_null
      - name: 負担重量
        description: 0.1Kg単位
        tests:
          - not_null
      - name: 見習い区分
        description: 1:☆(1K減),2:△(2K減),3:▲(3K減)
        tests:
          - not_null
          - accepted_values:
              values: [0, 1, 2, 3]
      - name: 馬場状態コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__going_codes')
              field: code
      - name: 天候コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__weather_codes')
              field: code

      # there are only 14 rows of null records (from 1999)
      - name: 単勝オッズ
        description: 単勝オッズ（データ作成時点）
      - name: 複勝オッズ
        description: 複勝オッズの下側
      - name: オッズ取得時間
        description: HHMM

      - name: 馬体重
      - name: 馬体重増減
        description: 符号+数字２桁、データ無:スペース
      - name: オッズ印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: パドック印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: 直前総合印
        tests:
          - relationships:
              to: ref('jrdb__symbol_codes')
              field: code
      - name: 馬体コード
        tests:
          - relationships:
              to: ref('jrdb__horse_form_codes')
              field: code
      - name: 気配コード
        tests:
          - relationships:
              to: ref('jrdb__demeanor_codes')
              field: code

      # todo: handle invalid times like 9:90
      - name: 発走時間
        description: HHMM

  - name: stg_jrdb__ukc
    columns:
      - name: ukc_sk
        # https://docs.getdbt.com/reference/resource-properties/quote
        quote: true
        tests:
          # Takes too long
          # - unique
          - not_null
      - name: ukc_bk
        quote: true
        tests:
          - unique
          - not_null
      - name: 血統登録番号
        quote: true
        tests:
          - not_null
      - name: 馬名
        quote: true
        tests:
          - not_null
      - name: 性別コード
        quote: true
        tests:
          - not_null
          - accepted_values:
              values: [1, 2, 3]
      - name: 毛色コード
        quote: true
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__hair_color_codes')
              field: code
      - name: 馬記号コード
        quote: true
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__horse_symbol_codes')
              field: code
      - name: 血統情報_父馬名
        quote: true
        tests:
          - not_null
      - name: 血統情報_母馬名
        quote: true
        # tests:
        #   - not_null
      - name: 血統情報_母父馬名
        quote: true
        tests:
          - not_null
      - name: 生年月日
        quote: true
        description: YYYYMMDD
      - name: 父馬生年
        quote: true
      - name: 母馬生年
        quote: true
      - name: 母父馬生年
        quote: true
      - name: 馬主名
        quote: true
      - name: 馬主会コード
        quote: true
        # tests:
        #   - relationships:
        #       to: ref('jrdb__racetrack_codes')
        #       field: code
      - name: 生産者名
        quote: true
      - name: 産地名
        quote: true
      - name: 登録抹消フラグ
        quote: true
      - name: データ年月日
        quote: true
        tests:
          - not_null
      - name: 父系統コード
        quote: true
        tests:
          - relationships:
              to: ref('jrdb__lineage_codes')
              field: code
      - name: 母父系統コード
        quote: true
        tests:
          - relationships:
              to: ref('jrdb__lineage_codes')
              field: code

  - name: stg_jrdb__oz
    description: 基準オッズデータ
    columns:
      - name: oz_sk
        tests:
          - unique
          - not_null
      - name: oz_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 登録頭数
        tests:
          - not_null
      - name: 単勝オッズ
        tests:
          - not_null
      - name: 複勝オッズ
        tests:
          - not_null
      - name: 連勝オッズ
        tests:
          - not_null

  - name: stg_jrdb__skb
    columns:
      - name: skb_sk
        tests:
          # Takes way too long. Just trust pyspark is doing this for us correctly
          # - unique
          - not_null
      - name: skb_bk
        tests:
          - unique
          - not_null
      - name: レースキー
        tests:
          - not_null
      - name: 開催キー
        tests:
          - not_null
      - name: レースキー_場コード
        tests:
          - not_null
          - relationships:
              to: ref('jrdb__racetrack_codes')
              field: code
      - name: レースキー_年
        tests:
          - not_null
      - name: レースキー_回
        tests:
          - not_null
      - name: レースキー_日
        tests:
          - not_null
      - name: レースキー_Ｒ
        tests:
          - not_null
      - name: 馬番
        tests:
          - not_null
      - name: 競走成績キー_血統登録番号
      - name: 競走成績キー_年月日
      - name: 特記コード
      - name: 馬具コード
      - name: 脚元コード_総合
      - name: 脚元コード_左前
      - name: 脚元コード_右前
      - name: 脚元コード_左後
      - name: 脚元コード_右後
      - name: パドックコメント
      - name: 脚元コメント
      - name: 馬具(その他)コメント
      - name: レースコメント
      - name: 分析用データ_ハミ
      - name: 分析用データ_バンテージ
      - name: 分析用データ_蹄鉄
      - name: 分析用データ_蹄状態
      - name: 分析用データ_ソエ
      - name: 分析用データ_骨瘤
